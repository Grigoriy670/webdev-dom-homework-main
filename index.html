<!DOCTYPE html>
<html>
  <head>
    <title>–ü—Ä–æ–µ–∫—Ç "–ö–æ–º–º–µ–Ω—Ç—ã"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments" id="comments-container">
        <!-- –¢—É—Ç –≤—ã–≤–æ–¥–∏–º –≤—Å–µ –∫–æ–º–º–µ–Ω—Ç—ã -->
      </ul>
      <div class="add-form">
        <input
          type="text"
          class="add-form-name"
          id="author"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è"
        />
        <textarea
          type="textarea"
          class="add-form-text"
          id="comment-text"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∫–æ–º–µ–Ω—Ç–∞—Ä–∏–π"
          rows="4"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button" id="add-comment">–ù–∞–ø–∏—Å–∞—Ç—å</button>
        </div>
      </div>
    </div>
        <pre id="log"></pre>
  </body>

  <script>
       
        let comments = [
            {
                id: 2,
                author: '–ì–ª–µ–± –§–æ–∫–∏–Ω',
                text: '–≠—Ç–æ –±—É–¥–µ—Ç –ø–µ—Ä–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ',
                date: new Date().toISOString(),
                likes: 3,
                liked: false
            },
            {
                id: 1, 
                author: '–í–∞—Ä–≤–∞—Ä–∞ –ù.',
                text: '–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –∫–∞–∫ –æ—Ñ—Ä–º–ª–µ–Ω–Ω–∞ —ç—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞! ü§ç',
                date: new Date().toISOString(),
                likes: 75,
                liked: true
            },
        ];
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const authorInput = document.getElementById('author');
        const commentTextInput = document.getElementById('comment-text');
        const addCommentBtn = document.getElementById('add-comment');
        const commentsContainer = document.getElementById('comments-container');
        const log = document.getElementById('log');
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
        function renderComments() {
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            commentsContainer.innerHTML = '';
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ –¥–∞—Ç–µ (—Å–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ)
            const sortedComments = [...comments].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            sortedComments.forEach(comment => {
                const commentElement = createCommentElement(comment);
                commentsContainer.appendChild(commentElement);
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        function createCommentElement(comment) {
            const commentElement = document.createElement('li');
            commentElement.addEventListener('click', () => {
                authorInput.value = comment.author;
                commentTextInput.value = `@${comment.author}, ${comment.text}\n`;
                commentTextInput.focus();

                commentTextInput.setSelectionRange(
                    commentTextInput.value.length,
                    commentTextInput.value.length
                );
            })
            commentElement.className = 'comment';
            commentElement.dataset.id = comment.id;
            
            const output = `
                <div class="comment-header">
                    <div>${comment.author}</div>
                    <div>${formatDate(comment.date)}</div>
                </div>
                <div class="comment-body">
                    <div class="comment-text">${comment.text}</div>
                </div>
                <div class="comment-footer">
                    <div class="likes">
                        <span class="likes-counter">${comment.likes}</span>
                        <button class="like-button ${comment.liked ? '-active-like' : ''}"></button>
                    </div>
                </div>
                <div class="remove">X</div>
            `;

            commentElement.innerHTML = output;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ª–∞–π–∫–∞
            const likeButton = commentElement.querySelector('.like-button');

            likeButton.addEventListener('click', (e) => {
                e.stopPropagation()
                toggleLike(comment.id)});
            
            const removeBtn = commentElement.querySelector('.remove');
            removeBtn.addEventListener('click', (e) => {
                e.stopPropagation()
                removeComment(comment.id)});
            
            return commentElement;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('ru-RU', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        function addComment() {
            const author = authorInput.value.trim();
            const text = commentTextInput.value.trim();
            
            if (!author || !text) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            const cleanText = text.replace(/<[^>]*>?/gm, '');

            const newComment = {
                id: Date.now(), // –∏—Å–ø–æ–ª—å–∑—É–µ–º timestamp –∫–∞–∫ ID
                author: author,
                text: cleanText,
                date: new Date().toISOString(),
                likes: 0,
                liked: false
            };
            
            comments.unshift(newComment);
            renderComments();
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞
            authorInput.value = '';
            commentTextInput.value = '';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ª–∞–π–∫–∞
        function toggleLike(commentId) {
            const comment = comments.find(c => c.id === commentId);
            if (comment) {
                comment.liked = !comment.liked;
                comment.likes += comment.liked ? 1 : -1;
                renderComments();
            }
        }
        
        function removeComment(commentId) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?')) {
                comments = comments.filter(comment => comment.id !== commentId);
                renderComments();
            }
        }
        
      addCommentBtn.addEventListener('click', addComment);

    commentTextInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && e.ctrlKey) {
        addComment();
    }
    });

    // –ì–ª–∞–≤–Ω—ã–π "DOMContentLoaded"
    document.addEventListener('DOMContentLoaded', () => {
    log.textContent += '–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é!\n';
    renderComments();
    });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        renderComments();
    </script>
</html>